{"./":{"url":"./","title":"对接综述","keywords":"","body":"渠道文档 本文档用以个人日常工作开发设计文档整理，维护人李靖、作者李靖 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 08:11:41 "},"rong360/融360在贷被拒用户召回.html":{"url":"rong360/融360在贷被拒用户召回.html","title":"融360在贷用户召回","keywords":"","body":"融360在贷被拒用户召回开发设计文档 一、需求背景 ​ 融360要实行最新的免撞库规则，即我方撞库接口所返的“被拒”或者“成功”无效，融360会根据自己既定的规则，进行进件； 鉴于此，融360会推进一部分在蛋花花其他平台“在贷”的用户，而我方业务以及风控会将此类用户拒绝掉，但此类用户已经结算。 二、需求目标 ​ 充分利用融360因“在贷”被拒的用户，将此类用户召回到我方 三、具体需求 以下所有的需求均需区分产品（以便统计）：融360PD14、PD15、大额 1.以上黄色标注的两个节点需给用户发送短信，具体节点的信息： - 风控进件前判断“在贷”被拒，需区分产品（融360PD14、PD15、大额） - 风控审核结果返回“在贷”被拒，需区分产品（融360PD14、PD15、大额） 2.短信内容： 【007】您在融360申请的蛋花花小额贷由于资质不符被拒，但您的条件符合蛋花花其他的借款产品，戳“http://t.cn/EUqVtyp” 立即申请，如不及时申请，资质可能失效， 退订回TD 3.短信中红色标注的内容，需做成可配置项 4.短信做成开关的形式，短信开关控制1所描述的两个短信触发时机 5.此需求上线时，在贷被拒的短信开关关闭；后期如需打开，需将短信内容修改后，再操作打开 6.接收到此短信的用户，需要给此类用户做标识，并且用户在我方所导流的app发起借款时，风控可以通过此标识，识别出此类用户，以便在策略上做调整 四、流程图 点击跳转 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:10:50 "},"bairong/百融大额API对接.html":{"url":"bairong/百融大额API对接.html","title":"百融大额渠道接入","keywords":"","body":"百融大额对接开发设计文档 需求背景  市场增量，合作大额产品，为后期合规化道路做准备 需求范围 榕树 APP 概要设计 描述 此需求对接的产品是大额授信产品，涉及的流程依次为：准入、进件、授信、用款确认、绑卡（包括新网开户）、订单审核、放款、还款 业务流程设计 一. 待开发功能列表 1.用户过滤接口  对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.1.html  注：使用 MD5 方式做校验 2.借款试算接口  对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.2.html 3.协议列表查询接口  对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.14.html 4.订单信息推送接口  对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.3.html  业务实现：  1.初始化用户信息、三方表信息、三方转换表信息、三方数据表（数据上传 OSS ）  2.初始化百融运营商数据拉取记录表（新建），记录榕树的 uid 5.授信数据拉取定时任务  对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.11.html  业务实现：  1.定时任务名称：RongshuOperatorPullJob  2.定时任务查询运营商数据拉取记录表中待拉取的记录，分别拉取运营商数据、信用卡数据、设备信息  3.更新三方表状态为待解析( 2 ) 6.榕树大额订单解析定时任务（新增）  业务实现：  1.定时任务名称：RongshuPushOrderJob  2.具体实现参照 融360 订单解析定时任务 7.发起授信申请定时任务修改 8.榕树授信结果回调处理消费者（新增） 业务实现： 1.消费者名称：RongshuCreditResultProcessor 2.业务实现参照 Rong360CreditResultProcessor 3.授信通过，三方表状态从授信中（ 11 ） 变为授信通过待确认（ 12 ）; 授信拒绝，三方表状态从授信中（ 11 ） 变为取消（ 4 ），并回调榕树审批拒绝 涉及的对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.1.html 9.审核结果查询接口 对方接口文档地址： https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.8.html 业务实现： 1.查询三方订单表，未授信状态（ 0，10，11 ），返回初审处理中（ 6003 ）；拒绝状态（ 4，5 ），返回初审拒绝（ 6004 ），失败原因：资质不符；授信通过的状态（ 12，1 ），返回初审通过 （ 6001 ） 10.支持银行卡列表接口 对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.15.html 业务实现： 1.查询 bank 表，已有实现的代码，参照即可 11.绑卡接口 对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.4.html 业务实现： 1.无验证码绑卡 2.首次绑卡时，调用绑卡 API 绑卡，且绑定的卡既是默认放款卡也是默认还款卡 3.重复绑卡，即当前卡已绑过，更新默认卡标识和绑卡时间 4.绑卡成功后，更新三方订单表 authInfo 字段的为已绑卡 5.具体实现参照 融360 绑卡接口 12. 用户确认借款接口开发 对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.7.html 业务实现： 1.如果用户已新网开户，接口逻辑如下： a.检查用户是否可借，如果可借，继续往下执行；不可借，接口返回拒贷 b.根据用户输入的借款金额、期限等初始化借款订单表数据 c.更新三方订单表状态，从 授信通过待确认（ 12 ）改为已处理（ 1 ） d.b 和 c 两个操作必须保证数据一致性，同时成功或同时失败 2.如果用户未新网开户成功，接口逻辑如下： a.表 cl_borrow_confirm_log 中记录该接口的业务参数；用户重复点击，这张表有对 orderNo 的唯一约束，捕获异常，做幂等。 b.接口中返回新网开户页地址 13.新网开户状态检查定时任务（新增） 业务实现： 1.定时任务名称：OpenapiXWAuthStateCheckJob 2.查询三方表中的状态是授信通过待确认（ 12 ），且新网认证申请表（ cl_depository_register_apply ）中的状态是 1 小时前发起申请的、状态没变更过的记录 3.查询表 cl_borrow_confirm_log 中的数据，执行功能列表 9 中的步骤 1。 4.如果和 9 出现并发，即初始化的借款订单重复，需要捕获异常做幂等，打出日志信息即可 14.订单风控审核... 15.榕树订单审核结果处理消费者（新增） 业务实现： 1.消费者名称：RongshuAuditResultProcessor 2.如果订单审核通过，直接 return；审核拒绝，生成榕树放款失败-拒件处理（ 7003 ）的回调 涉及的对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.2.html 16.榕树放款结果处理消费者（新增） 业务实现： 1.消费者名称：RongshuLoanResultProcessor 2.该消费者的业务功能只有一个：处理放款失败后，运营在管理后台拒单的业务，即判断订单状态是否等于人工复审拒绝（ 27 ），如果是，生成榕树放款失败-拒件处理（ 7003 ）的回调 涉及的对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.2.html 17.放款结果查询接口 对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.9.html 业务实现： 1.查询借款订单表（ cl_borrow ）,如果是审核中和放款失败的状态（ 0，10，13，20，31 ），返回放款中（ 7002 ）；如果是人工复审拒绝（ 27 ），返回放款失败-拒单处理（ 7003 ），如果是已放款状态（ 30，40，41 ），返回放款成功 18.还款计划查询接口 对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.13.html 业务实现： 1.查询还款计划，按照接口要求返回数据 19.生成还款计划消费者（ RepayPlanProcessor ）（修改） 业务实现： 1.在还款计划生成后的回调处理业务中，增加生成榕树放款成功的回调 2.代码位置：repayPlanOpenAPI.callBackWhenLoanSuccess 涉及对方接口文档地址：https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.2.html 20.榕树订单逾期处理消费者（新增） 对方接口文档：https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.4.html 1.消费者名称：RongshuOverdueProcessor 2.生成还款计划的回调，具体方法在 API 中实现，其他地方还要用该方法 21.主动还款试算接口 对方接口文档：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.10.html 业务实现： 1.查询订单的还款计划再判断 2.参照接口描述 22.主动还款接口 对方接口文档：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.11.html 业务实现： 1.参照 融360 还款接口 23.还款结果处理消费者（新增） 对方接口文档https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.3.html 业务实现： 1.还款后，回调处理用 2.还需要回调还款计划 24.还款结果查询接口 对方接口文档：https://dymapi.xiaqiu.cn/groot/_book/chapter2/product/1.12.html 业务实现： 1.参照接口描述 25.其他 1.拦截器开发、生成回调的公共方法、回调方法 2.产品基础数据配置，准入规则配置、新网开户页配置 3.授信&审核被拒后的可借日期配置、短信签名配置 表结构设计 新建表 ：rongshu_credit_data_pull_log 历史数据处理 无 流程图 点击跳转 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:08:28 "},"bairong/百融大额对接连资贷.html":{"url":"bairong/百融大额对接连资贷.html","title":"百融大额对接连资贷","keywords":"","body":"百融大额对接连资贷开发设计文档 需求背景 百融大额对接连资贷 需求范围 榕树贷App 概要设计 描述 此需求为对接连资贷，切换资金路由 业务流程设计 流程参考51连资贷: https://www.processon.com/view/link/5cab3227e4b031d02260e3e2 对方接口总地址: https://dymapi.xiaqiu.cn/groot/_book/chapter1/ 待开发功能列表 1.授信通过增加资金平台路由处理 我方授信结果消费者com.jindan.fenqi.rongshu.RongshuCreditResultProcessor 2.绑卡根据资金类型返回百融开户存管地址 com.jindan.fenqi.flow.rongshu.api.RongshuBankCardAPI#bindCard 3.根据路由规则组装借款页信息展示（包含自有/理财/连资贷） 对方接口地址: 未提供 4.新网、百信开户失败再次请求路由逻辑处理 com.jindan.fenqi.schedule.job.OpenapiXWAuthStateCheckJob(修改) com.jindan.fenqi.schedule.job.OpenapiBXAuthStateCheckJob(新增) 5.百信银行存管开户流程 需要前端提供H5落地页地址 com.jindan.fenqi.api.controller.h5.flow.fund.H5FundOpenAccountController#openAccount 6.借款试算 判断是否需要切换路由，计算保单费等组装数据 com.jindan.fenqi.flow.rongshu.api.RongshuBorrowAPI#getCalcuLateDetail 7.确认借款是否需要发送保险签约短信、发送保险签约短信、保险出单申请、资金平台进件、返回三方待取现状态 com.jindan.fenqi.flow.rongshu.api.RongshuBorrowAPI#borrowComfirm 8.保单签约失败再次请求路由逻辑处理 新增 9.借款审核通过后连资贷保单创建失败、保单不满足资金方要求、满足推送失败路由切换处理 新增 我方审核结果消息消费者 com.jindan.fenqi.rongshu.RongshuAuditResultProcessor 10.借款审核通过推送资金方成功，记录后回调百融待取现（7005）需返回百信银行放款确认页 对方接口地址: https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.2.html 需百融修改接口参数增加百信放款确认页展示 我方审核结果消息消费者 com.jindan.fenqi.rongshu.RongshuAuditResultProcessor 11.放款业务处理 放款后通知保险扣款，成功款项到账，失败第一期还款及计划收取款项到账，百融需通知用户（展示保险费用放在第一期还款的还款计划）放款失败切换路由 对方接口地址: https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.4.html 我方放款结果消息消费者 com.jindan.fenqi.rongshu.RongshuLoanResultProcessor 12.用户提现相关业务逻辑处理 新增 13.榕树资金平台放款结果处理消费者 RongshuFundLoanResultProcessor（新增） 14.榕树贷协议列表新增保险相关协议 com.jindan.fenqi.flow.rongshu.api.RongshuContractAPI#listContract 15.还款试算接口保单费用处理 com.jindan.fenqi.flow.rongshu.api.RongshuRepayAPI#repayTryCalculate 16.保单扣款失败，还款计划变更 表结构设计 17.提现记录回调 对方接口地址 https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.13.html 暂无 sql 变更 sql-deploy 位置: 201904/0409-榕树贷对接连资贷/百融大额对接连资贷DML.sql 放款结果查询 放款结果回调code修改 借款确认短信验证码发送 借款确认短信验证码接收 试算接口增加还款计划试算 待提现状态回调我方状态确认应该处于什么态？ 流程图 点击跳转 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:08:54 "},"common/新老用户撞库规则.html":{"url":"common/新老用户撞库规则.html","title":"新老用户过滤","keywords":"","body":"新老用户撞库规则开发设计文档 新老用户撞库规则 撞库新老用户中的老用户的定义，针对不同渠道可以做配置 撞库新老用户的判断中，对于老用户的定义的可配置内容有两种，现有的趣花钱注册用户是其中一种形式，增加另外一种形式的配置（全产品注册用户），详情见附件 此需求上线时，针对不同的趣花钱渠道做不同的配置（详情见附件） 详细规则说明 责任链设计类图 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:10:23 "},"51/51修改收费方式.html":{"url":"51/51修改收费方式.html","title":"51大额收费方式修改","keywords":"","body":"51大额修改收费方式开发设计文档 需求说明 51大额的协议需进行修改，修改为趣花钱协议（我方协议：注册协议和借款协议），与百融大额的协议一致就行（保险的协议不用动，维持原样）。 51大额，当用户绑定的银行卡与保险卡不一致时，与百融一样，做“签约失败”处理（切路由，不阻断后续流程） 修改51收费方式 流程图 点击跳转 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:09:04 "},"51/51直放直还需求.html":{"url":"51/51直放直还需求.html","title":"51大额直放直还","keywords":"","body":"直放直还开发设计文档 北斗项目迁移至openapi 删除api中北斗相关代码 拦截器修改 配置项迁移至openapi_global 直放直还 流程图 点击跳转 发送短信验证码 点击跳转 验证短信验证码 点击跳转 借款确认 我方请求地址 /api/beidou/borrow/borrowApply 三方文档地址: 审批结论反馈接口 http://book.dev.geinihua.com/doc-big/approvalResultsFeedback.html 审批确认接口 http://book.dev.geinihua.com/doc-big/approvalConfirm.html Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:09:19 "},"youdeyong/有得用对接开发设计文档.html":{"url":"youdeyong/有得用对接开发设计文档.html","title":"有得用渠道接入","keywords":"","body":"有得用对接开发设计文档 业务背景 接业务方通知，树贷熊接一个新的API渠道“有得用” Git分支 20190628_fenqi_lijing_dey2rp 交互流程 交互流程图详见产品需求附件 业务流程 有得用对接业务流程图 基础功能 有得用拦截器（包含验签） 新增 撞库接口 新增 基本信息推送接口 新增 补充信息推送接口 新增 银行卡列表接口 新增 绑卡接口 新增 绑卡验证码接口 新增 拉取订单审批结果 新增 借款试算接口 新增 借款确认（审批确认）接口 新增 合同接口 新增 还款计划拉取接口 新增 拉取订单状态接口 新增 主动还款接口 新增 还款验证码接口 新增 还款详情获取接口 新增 回调功能 授信回调 对方接口名称：审批反馈结论接口 4.8 调用场景： 当机构完成审批时，调用有得用接口反馈审批结果 绑卡结果回调 对方接口名称：绑卡反馈接口 4.7 调用场景： 当机构获取到最终的绑卡结果时，需要调用有得用接口告知用户绑卡结果 订单状态回调 对方接口名称：订单状态反馈接口 4.14 调用场景： 机构放款完成时，即变成放款成功或放款失败时，调用有得用接口。 订单状态变更为贷款取消时，调用有得用接口 订单状态变更为逾期时，调用有得用接口 订单状态变更为贷款结清时，调用有得用接口 还款结果回调 对方接口名称：还款结果反馈接口4.19 调用场景： 代扣完成后，不论还款成功，还是还款失败时 用户主动还款后，获取到还款结果后 还款计划回调 对方接口名称：还款计划推送4.12 调用场景： 放款完成后，调用有得用接口告知还款计划 用户还款后，调用有得用接口更新还款计划 用户逾期后，调用有得用接口更新还款计划 用户更换还款银行卡后，调用有得用接口更新还款计划中的银行卡 其他情况导致还款计划变更，调用有得用接口更新还款计划 定时任务 订单解析 新增 渠道授信定时任务（修改） ThirdOrderApplyCreditJob 风控审核申请定时任务（修改） BorrowRiskApplyJob MQ消息队列 订单审核结果消费者 新增 授信审核结果消费者 新增 逾期结果消费者 新增 放款结果消费者 新增 还款结果消费者 新增 还款计划消费者 新增 其它 渠道配置（产品） 产品配置、产品费用、产品费率配置（产品） 产品流程控制配置 短信签名配置 运营商类型配置 快捷支付开关配置 短信开关配置 协议配置 撞库规则配置 渠道 openapi_sys_config 相关配置 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-06-28 15:32:09 "},"flowChart/三方表状态.html":{"url":"flowChart/三方表状态.html","title":"三方表状态流程图","keywords":"","body":"三方表状态流转 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:04:16 "},"flowChart/融360在贷被拒用户召回.html":{"url":"flowChart/融360在贷被拒用户召回.html","title":"融360在贷用户召回","keywords":"","body":"��360�ڴ������û��ٻ� Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-29 11:05:09 "},"flowChart/融360业务流程.html":{"url":"flowChart/融360业务流程.html","title":"融360业务流程图","keywords":"","body":"融360业务流程 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:02:45 "},"flowChart/百融渠道对接.html":{"url":"flowChart/百融渠道对接.html","title":"百融渠道对接","keywords":"","body":"　新网开户流程 　新网开户超时定时任务 　订单解析定时任务 　数据拉取定时任务 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:01:36 "},"flowChart/51修改还款方式.html":{"url":"flowChart/51修改还款方式.html","title":"51修改还款方式流程图","keywords":"","body":"51大额还款方式 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:00:47 "},"flowChart/连资贷流程.html":{"url":"flowChart/连资贷流程.html","title":"连资贷流程","keywords":"","body":"连资贷开户 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:02:24 "},"flowChart/百融对接连资贷.html":{"url":"flowChart/百融对接连资贷.html","title":"百融对接连资贷流程图","keywords":"","body":"　百融对接连资贷 百融对接连资贷整体流程 连资贷处理流程 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 17:36:25 "},"flowChart/开户流程.html":{"url":"flowChart/开户流程.html","title":"开户流程图","keywords":"","body":"　新网开户流程 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:02:01 "},"flowChart/直放直还.html":{"url":"flowChart/直放直还.html","title":"直放直还流程图","keywords":"","body":"直放直还借款前流程 直放直还整体流程 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-21 14:30:12 "},"sms/sendSms.html":{"url":"sms/sendSms.html","title":"短信发送接口","keywords":"","body":"发送短信接口文档 1. 接口说明 本接口主要针对借款前发送短信验证码。 借款确认前调用此接口处理保险签约和连资贷签约相关短信发送业务 2. 接口 URL 请求方式: post 请求地址: ${domain}/api/h5/openapi/borrow/sendBorrowConfirmSms 3. 请求参数 参数 类型 是否必选 描述 orderNo string 是 我方订单号 optType int 是 操作类型1支付协议签约2保险签约 4. 响应参数 参数 类型 是否必选 描述 code integer 是 响应码，如200 msg integer 是 响应信息，如成功 data Object 是 json数据 5. 请求示例 略 6. 响应示例 { \"code\": 200, \"data\": { \"optType\": 2, \"orderNo\": \"HK76190517450442\", \"phone\": \"15313288116\", \"state\": true }, \"msg\": \"成功\" } Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:11:14 "},"sms/verifySms.html":{"url":"sms/verifySms.html","title":"短信验证接口","keywords":"","body":"短信确认接口文档 1. 接口说明 本接口主要针对借款前验证短信验证码。 借款确认前调用此接口处理保险签约和连资贷签约相关短信发送业务 2. 接口标识 请求方式： post 请求地址：${domain}/api/h5/openapi/borrow/verifyBorrowConfirmSms 3. 请求参数 参数 类型 是否必选 描述 orderNo string 是 我方订单号 optType int 是 操作类型1保险签约2支付认证 captcha string 是 验证码 4. 响应参数 参数 类型 是否必选 描述 code integer 是 响应码，如200 msg integer 是 响应信息，如成功 data Object 是 json数据 5. 请求示例 略 6. 响应示例 { \"code\": 200, \"data\": { \"jumpUrl\": \"https://gateway-openapi-test01.XXX.XXX\", \"optType\": 2, \"orderNo\": \"HK76190517450442\", \"phone\": \"15313288116\", \"state\": false }, \"msg\": \"成功\" } Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:11:30 "},"borrow/borrowApply.html":{"url":"borrow/borrowApply.html","title":"借款申请接口","keywords":"","body":"借款申请接口文档 1.接口说明 用于短信验证通过后，确认借款时使用。 2. 接口 URL /api/beidou/borrow/confirm 3.请求参数 参数 类型 是否必须 说明 orderNo String Y 订单号 loanAmount String Y 借款金额 loanTerm String Y 借款期限 loanUnit int Y 期限单位 1-日 2-月 3-年 repayReturnUrl String N 确认借款回跳地址 示例： 略 4. 响应参数 参数 类型 是否必须 说明 code integer 是 响应码，如200 msg integer 是 响应信息，如成功 data Object 是 json数据 示例： { \"code\": 200, \"msg\": \"成功\", \"data\": {\"result\":\"200\",\"remark\":\"success\"} } Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-28 18:09:56 "},"appendix.html":{"url":"appendix.html","title":"附录","keywords":"","body":"银行编码表 银行 银行编码 农业银行 ABC 交通银行 BCOM 工商银行 ICBC 邮储银行 PSBC 广发银行 GDB 平安银行 PAB 招商银行 CMB 中国银行 BOC 建设银行 CCB 光大银行 CEB 兴业银行 CIB 中信银行 CITIC 华夏银行 HXB 浦发银行 SPDB 北京银行 BOB 上海银行 BOSC 民生银行 CMBC Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-13 16:12:58 "},"FAQ.html":{"url":"FAQ.html","title":"FAQ","keywords":"","body":"问题汇总: 多线程下拉取运营商数据会存在连接已关闭异常 解决：并发导致已通过redisLock限制 加签验签需要与三方确认使用相同的方式 问题：不一致会导致双方验签失败，对方给的demo和实际使用的算法不一致 三方状态 更改为待授信确认，借款确认提示授信订单不存在 原因：授信定时任务授信订单异常，借款确认初始化风控数据异常 确认借款前，如果没有收到绑卡成功的通知，就不能做确认借款 解决：查询到的绑卡成功结果或者回调的绑卡成功结果都算已经新网开户了，然后就可以确认借款了 授信查询订单状态为待处理的状态 2的订单,如果认证项为通过会返回失败三方订单状态变更为5 绑卡需要新网开户，就返回 3004；不需要新网开户，就返回 3001，然后就可以借款确认了。 授信被拒 修改状态 cl_jd_credig_reg_log 查询原因为 授信余额不足,需要修改账户信息表中的对应可用金额 风控数据推送异常,需要手动跑下推送报文查看是否有信用卡、运营商报告等数据 消费者回调没有加compnent注解,会导致消费者不生效 出问题了？问题排查？如何快速排查问题？ springboot项目起不来直接exit with code 1 原因： mapper扫描未扫描到rongshucreditpulldatalogApi所用到的mapper 坑在于未抛异常 com.jindan.fenqi.user.biz.impl.UserCreditAccountRequestRiskBizImpl#generateOrderRiskDTO 需要返回运营商类型，否则风控会拒 com/jindan/fenqi/order/biz/impl/BorrowRiskBizImpl.java:1170 需要返回运营商类型 风控被拒原因统计 select *from risk_strategy_statistics order by id desc ; 二审被拒原因: 产品id BorrowBo中的productId 不是真实id 需要重新查询获取 推送风控 如果需要订单的详细信息使用borrowDetailBo 其实质是borrowBo + borrowExtendInfo的 组合 榕树新网开户相关的表，如果用户已开户需要修改身份证号码请求新网开户，否则会抛异常用户已开通新网存管 select from cl_depository_register_info order by id desc; select from openapi_user_auth_record order by id desc ; 当前产品配置的必须认证项 select *from third_order_auth_item where source = 30; 风控授信审核记录 select *from cl_jdcredit_req_log where product_id = 47 order by id desc; 模拟放款 还款结果 select *from arc_sys_config where code like \"%mock%\" ; 跳过风控审核流程 select *from cl_user where channel_id = -1; topic消费者每个环境都需要维护自己的mq订阅方，如果消息长时间没有回调可通过阿里云管理控制台排查当前消费者状态以及消息重发 榕树贷生成借款计划后回调三方借款成功 RepayPlanProcessor 回调中通知三方借款成功 融360 新网认证流程将请求数据缓存到了redis中处理方式比较不合理 新网开户流程使用陈龙封装的最新版 榕树贷有终审拒绝但是没有终审通过状态 新网认证提示异常 确认当前openapi配置的是否为直接跳转到三方 select from openapi_sys_config where code = \"DEPOSITORY_REDIRECT_SUCCESS_URL:30\"; 存管后台url SELECT FROM arc_sys_config t WHERE t.code = 'JINDAN_DEPOSITORY_REDIRECT_URL'; splunk搜索日志发现日志打至渠道01 保险是否签约确认项: 01当前资金方productFee是否配置 select from cl_product_fee where product_id = 47 and fund_code = \"LIANZIDAI\"; 配置为放款后收取 收款方式为QA 02当前用户银行卡QA是否支持 03保险开关开启 select from arc_sys_config where code = \"policy_switch\"; 04账户管理表 select from user_credit_account where product_id = 47 and user_id = 4000527; riskMakePrice: [{\"rateType\":\"2\",\"interest\":0.36,\"serviceInterest\":0.00,\"maxValidity\":6,\"repayType\":\"2\",\"termUnit\":\"2\"}] riskMakePrice为null 不签约 判断利率配置是否为等额本息 否不签约 riskMakePriceBO.getServiceInterest 服务费== null 或者 小于等于0 不签约 05 判断系统配置展示样式 select from arc_sys_config where code = \"qa_policy_show_style\"; 风控授信数据返回不需要手续费导致不需要签约 连资贷产品还款方式一定需要配置为等额本金，如果为等本等息会返回不需要短信签约，是否短信签约只与还款方式有关，与资金方无关 产品流程控制表是否配置支持资金路由 select from cl_product_flow_config where product_id = 47; fund_flag 产品推资产类型 select from cl_product where id = 47; asset_type字段 请求路由-资金方有变化切换三方表资金方 存管认证相关数据查询 存管回调地址数据 select *from openapi_user_auth_record order by id desc limit 10; 消费降级导致三方表中没有订单号需要去三方转换表中查询 切换路由时机 开户失败、签约失败、会放到确认订单切换路由 榕树拉取配置两个相同的导致任务不跑 榕树数据库配置禁用导致任务不执行 数据库会定时同步，导致字段删不掉 {\"credit_card\":true,\"operator_basic\":true,\"operator_report\":true,\"device\":true,\"id_front\":true,\"id_back\":true,\"living_image\":true} 各种环境配置的坑 推送风控审核后没下文，一步步跟代码排查为环境配置异常 com.jindan.fenqi.common.exception.BaseRuntimeException: 未配置系统变量 app_environment at com.jindan.fenqi.core.common.util.BizSysUtil.isProd(BizSysUtil.java:36) 关键节点加日志 固定配置修改功能验完后恢复原配置 授信被拒需要修改参数pass直接通过 select *from arc_sys_config where code = \"mock_fico_credit\"; -- 修改为pass即可 注意更新缓存 在贷被拒修改数据 select from cl_borrow where user_id = 4000521; 将当前订单状态改为已结束 审核被拒修改数据 select from user_can_loan_date where user_id = 4000521; select *from rongshu_credit_data_pull_log where user_id = 4000521; -- 审核被拒 定时任务没执行查询数据库状态配置未启用 需要找资金平台给配置路由到连资贷 数据库会同步过来删除的字段且为必填导致代码异常，需要找马一超暂停当前数据库表的同步 https://dymapi.xiaqiu.cn/dbclear/index 填写 pid 10595 和手机号 存管请求会转发到api api中抛出的异常导致开户落地页跳转失败 资金平台请求地址test02中配置域名为生产环境导致请求路由失败 返回UNKOWN 资金方 环境问题太多,排查问题时在不熟悉业务具体执行步骤的情况下很耽误时间 对接连资贷需要对方配置路由信息 身份证号 手机号 银行卡 产品code 走的老请求方式需要添加域名代理 否则请求的是线上的 47.94.175.76 6669 代理 资金平台环境切换目前他们稳定的系统是02 百信存管会同时校验身份证和手机号，如果需要修改信息重新进件需要同时修改 确认借款提示授信订单不存在 手动更改了授信数据 代码会校验当前授信订单状态是不是3 还款方式使用我们自己配置的如果使用风控返回的会抛异常空指针异常 资金平台进件本地请求不通，通过http方式请求内网域名请求不通 资金平台路由成功，但是审核后校验是否保单收费导致路由切换 资金平台路由切换会强制切换，原因保险未签约，切换路由 人为制造数据需要将短信签约申请表中的数据也修改掉 host=\"test-plat-channel-01\" 重新触发放款repayApply中的记录要清楚否则消费者会人为是重复放款,所以不会处理放款消费者 放款被拒后资金平台未推送放款失败数据需要找张鹏排查（唐鹏不管） 订单确认借款推送风控，审核通过后资金平台向连资贷方请求放款，请求成功通过mq消息推送给我们，接收到消息后如果是待放款确认状态，回调百融待提现，百融页面进行提现验证。 资金方放款失败切换为蛋花花路由放款，失败原因上午跟资金方确认回复忙没时间处理，下午回复说就是这样处理的,需要研华来帮忙沟通连资贷方处理为放款成功 银行卡中的手机号需要和开户时候手机号保持一致 授信userCreditAccount 制造签约信息 qa_apply 17191251071 420112198909251588 资金平台查到同一账号下有两个不同身份证号进件信息 INSERT INTO ijindantest.cl_depository_register_info (id, depository_channel, platform_no, apply_id, user_id, id_no, phone, name, card_no, bank_code, user_type, import_user_activate, card_no_is_change, audit_status, auth_fail_time, auth_amount, auth_list, virtual_card_no, user_status, remark, is_enable, is_deleted, gmt_create, gmt_modified, company_main_body) VALUES (213, 'JINDAN_LICAI', '', 966, 4000530, '130126198912251537', '15032068969', '李靖', '6212260200161231754', 'ICBK', 'PERSONAL', 0, 0, 'PASSED', '2029-04-19', 400000, 'REPAYMENT', '', 'ACTIVATED', '', 1, 0, '2019-04-19 16:47:52', '2019-04-19 16:47:52', 'JINDANFENQI'); 7119041916285894 源三方订单号 放款被切路由原因 保险签约记录不存在 1 签约 2 签约认证 3 借款确认 4 签约查询返回未签约 结果不初始化签约申请表 风控重复 cl_ficorist_req_log中存在相同的订单号 .* \"c.j.f.o.i.RongshuInterceptor\" \"URI:/api/rongshu/borrow/sendBorrowConfirmSms\" 进件开户输入的手机号必须与cl_bank_card中phone对应 模拟风控授信/提额 mock_fico_credit pass 模拟风控授信/提额结果：normal-正常 pass-审核通过 noPass-拒绝 连资贷路由资金平台 需要开启产品的fundflag 1 为什么二推提示订单不存在 三方订单不存在，51订单未删除，查日志没有基础信息推送直接就是补充信息推送 修改资金平台确认项： 1.资金平台请求地址目前有test01、test02 select *from arc_sys_config where code = \"fund_system_url\"; 2.当前环境有没有配资金平台host,如果没有会提示host not found 51提现验证页面404 select *from arc_sys_config where code = \"flow_lianzidai_withdraw_h5_url_key\"; 经查询没有配置提现页面导致 product服务超时问题 此问题一般为产品利率配置等未配置导致 为什么没请求路由1 productflowconfig fund_flag配置为0导致 绑卡成功 跳转404 没有配置 发送短信异常提示json格式化异常 短信配置错误导致 select *from arc_sys_config where code = \"source_sms_prefix_config\" ; 连资贷进件后不放款 select *from fund_in_order_info where user_id = 4000548; 处理中 51信用卡 缓存授信结果导致授信失败，卡流程 {\"code\":400,\"message\":\"预授信金额错误,最大授信金额小于最小授信金额\"} 51方对订单授信数据缓存，第一次失败后后边的都不会成功 推风控定时任务5分钟一次获取阻断redis key：FUND_BLOCK:6222620910008266532_4037245_39，阻断的资金方：LIANZIDAI 逾期上限设置为50，订单逾期到20后不再追加 原因：开启了自动扣款定时任务，自动扣款成功，本金已还，不再计算逾期 文档持续完善中，欢迎提出改进意见！ Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-06-04 11:06:01 "},"version.html":{"url":"version.html","title":"版本信息","keywords":"","body":"版本记录 版本号 日期 作者 内容 V1.0 2019-5-13 18:02:18 李靖 创建文档 Copyright ©2018-2019 all right reserved，powered by Gitbook修订时间： 2019-05-13 18:02:32 "}}