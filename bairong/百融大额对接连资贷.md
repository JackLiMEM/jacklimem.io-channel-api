# 百融大额对接连资贷开发设计文档

## 需求背景

百融大额对接连资贷
## 需求范围
榕树贷App
## 概要设计
描述
此需求为对接连资贷，切换资金路由

业务流程设计
流程参考51连资贷:

https://www.processon.com/view/link/5cab3227e4b031d02260e3e2

对方接口总地址:

https://dymapi.xiaqiu.cn/groot/_book/chapter1/

## 待开发功能列表
#### 1.授信通过增加资金平台路由处理
我方授信结果消费者com.jindan.fenqi.rongshu.RongshuCreditResultProcessor

#### 2.绑卡根据资金类型返回百融开户存管地址
com.jindan.fenqi.flow.rongshu.api.RongshuBankCardAPI#bindCard

#### 3.根据路由规则组装借款页信息展示（包含自有/理财/连资贷）
对方接口地址: 未提供

#### 4.新网、百信开户失败再次请求路由逻辑处理
com.jindan.fenqi.schedule.job.OpenapiXWAuthStateCheckJob(修改)
com.jindan.fenqi.schedule.job.OpenapiBXAuthStateCheckJob(新增)

#### 5.百信银行存管开户流程
需要前端提供H5落地页地址
com.jindan.fenqi.api.controller.h5.flow.fund.H5FundOpenAccountController#openAccount

#### 6.借款试算 判断是否需要切换路由，计算保单费等组装数据
com.jindan.fenqi.flow.rongshu.api.RongshuBorrowAPI#getCalcuLateDetail

#### 7.确认借款是否需要发送保险签约短信、发送保险签约短信、保险出单申请、资金平台进件、返回三方待取现状态
com.jindan.fenqi.flow.rongshu.api.RongshuBorrowAPI#borrowComfirm

#### 8.保单签约失败再次请求路由逻辑处理
新增

#### 9.借款审核通过后连资贷保单创建失败、保单不满足资金方要求、满足推送失败路由切换处理
新增
我方审核结果消息消费者 com.jindan.fenqi.rongshu.RongshuAuditResultProcessor

#### 10.借款审核通过推送资金方成功，记录后回调百融待取现（7005）需返回百信银行放款确认页
对方接口地址: https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.2.html 

需百融修改接口参数增加百信放款确认页展示
我方审核结果消息消费者 com.jindan.fenqi.rongshu.RongshuAuditResultProcessor

#### 11.放款业务处理
放款后通知保险扣款，成功款项到账，失败第一期还款及计划收取款项到账，百融需通知用户（展示保险费用放在第一期还款的还款计划）放款失败切换路由
对方接口地址: 
https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.4.html

我方放款结果消息消费者 com.jindan.fenqi.rongshu.RongshuLoanResultProcessor

#### 12.用户提现相关业务逻辑处理
新增

#### 13.榕树资金平台放款结果处理消费者
RongshuFundLoanResultProcessor（新增）

#### 14.榕树贷协议列表新增保险相关协议
com.jindan.fenqi.flow.rongshu.api.RongshuContractAPI#listContract
#### 15.还款试算接口保单费用处理
com.jindan.fenqi.flow.rongshu.api.RongshuRepayAPI#repayTryCalculate
#### 16.保单扣款失败，还款计划变更
## 表结构设计
17.提现记录回调
对方接口地址

https://dymapi.xiaqiu.cn/groot/_book/chapter2/platform/1.13.html

暂无

## sql 变更 
sql-deploy 位置:
201904/0409-榕树贷对接连资贷/百融大额对接连资贷DML.sql

放款结果查询
放款结果回调code修改
借款确认短信验证码发送
借款确认短信验证码接收
试算接口增加还款计划试算
待提现状态回调我方状态确认应该处于什么态？

## 流程图

> [点击跳转](/flowChart/百融对接连资贷.md)

